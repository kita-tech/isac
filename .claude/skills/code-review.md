# Code Review Skill

コードを3人のペルソナで多角的にレビューします。

## 使い方

```
/code-review [ファイルパス]
/code-review [コードブロック]
```

## ペルソナ

| ペルソナ | 専門 | チェック観点 |
|---------|------|-------------|
| セキュリティ専門家 | 脆弱性診断・セキュリティ設計 | インジェクション、認証・認可、データ漏洩、OWASP Top 10 |
| パフォーマンス専門家 | 最適化・スケーラビリティ | 計算量、メモリ使用、N+1問題、キャッシュ、非同期処理 |
| 品質・保守性専門家 | コード品質・設計パターン | 可読性、命名、DRY/SOLID、テスト容易性、エラーハンドリング |

## レビューフォーマット

各ペルソナは以下の形式でレビュー結果を報告：

```
**🔒 [名前]（セキュリティ専門家）**

### 検出事項
| 重要度 | 行 | 指摘内容 |
|--------|-----|---------|
| 🔴 高 | L23 | SQLインジェクションの可能性 |
| 🟡 中 | L45 | ハードコードされた認証情報 |
| 🟢 低 | L12 | 入力値の検証が不十分 |

### 推奨事項
- プリペアドステートメントを使用
- 認証情報は環境変数から取得
```

## 重要度の定義

| 重要度 | 説明 | 対応 |
|--------|------|------|
| 🔴 高 (Critical) | セキュリティ脆弱性、本番障害の可能性 | 即時修正必須 |
| 🟡 中 (Warning) | パフォーマンス問題、保守性の懸念 | 修正推奨 |
| 🟢 低 (Info) | 改善提案、ベストプラクティス | 検討 |

## 出力フォーマット

```
## 🔍 コードレビュー結果

### 対象
- ファイル: `path/to/file.py`
- 行数: XX行

---

**🔒 渡辺（セキュリティ専門家・7年目）**

### 検出事項
| 重要度 | 行 | 指摘内容 |
|--------|-----|---------|
| ... | ... | ... |

### 推奨事項
- ...

---

**⚡ 山田（パフォーマンス専門家・8年目）**

### 検出事項
| 重要度 | 行 | 指摘内容 |
|--------|-----|---------|
| ... | ... | ... |

### 推奨事項
- ...

---

**📐 佐々木（品質・保守性専門家・10年目）**

### 検出事項
| 重要度 | 行 | 指摘内容 |
|--------|-----|---------|
| ... | ... | ... |

### 推奨事項
- ...

---

## 📊 サマリー

| 重要度 | 件数 |
|--------|------|
| 🔴 高 | X件 |
| 🟡 中 | Y件 |
| 🟢 低 | Z件 |

## 🎯 優先対応事項

1. [最も重要な指摘]
2. [次に重要な指摘]
3. [その次]

---

指摘事項を修正しますか？ (Yes/No)
```

## チェック項目詳細

### セキュリティ（🔒）

- [ ] SQLインジェクション
- [ ] XSS（クロスサイトスクリプティング）
- [ ] CSRF（クロスサイトリクエストフォージェリ）
- [ ] 認証・認可の不備
- [ ] 機密情報のハードコード
- [ ] 安全でない暗号化
- [ ] パストラバーサル
- [ ] コマンドインジェクション
- [ ] 安全でないデシリアライゼーション
- [ ] ログへの機密情報出力

### パフォーマンス（⚡）

- [ ] O(n²)以上の計算量
- [ ] N+1クエリ問題
- [ ] 不要なメモリ確保
- [ ] 同期処理のボトルネック
- [ ] キャッシュ未使用
- [ ] 不要なループ・再計算
- [ ] 大きなペイロード
- [ ] インデックス未使用のクエリ
- [ ] リソースリーク（未クローズ）
- [ ] 不要なデータ取得

### 品質・保守性（📐）

- [ ] 命名の不明確さ
- [ ] 関数の長さ（50行超）
- [ ] 循環的複雑度（10超）
- [ ] DRY原則違反
- [ ] SOLID原則違反
- [ ] エラーハンドリング不足
- [ ] マジックナンバー
- [ ] コメント不足/過剰
- [ ] テスト困難な構造
- [ ] 型ヒント/ドキュメント不足

## CLAUDE.md 連携

プロジェクトの `CLAUDE.md` に記載されたコーディング規約も自動的にチェック対象に含めます。

## オプション

| 指定 | 説明 |
|------|------|
| `/code-review` | 3人フルレビュー |
| `/code-review --security` | セキュリティ観点のみ |
| `/code-review --performance` | パフォーマンス観点のみ |
| `/code-review --quality` | 品質・保守性観点のみ |

## 修正後の再レビュー

指摘事項を修正した後、再度 `/code-review` を実行して修正を確認できます。

## 関連スキル

- `/review` - 設計レビュー（方針・アーキテクチャの検討）
- `/decide` - 決定の記録
- `/memory` - 記憶の検索・管理
- `/suggest` - 状況に応じたSkill提案
